{"version":3,"sources":["scripts/foursquare-script.js"],"names":["checkFoursquareLoginState","chrome","storage","sync","get","result","foursquareToken","handleButtons","addListenerFor","fnFor","callback","listener","listenerFor","addEventListener","event","data","to","connectFoursquare","listenerForConnectCallback","connectCallback","window","open","authUrl","windowOptions","removeEventListener","search","response","substr","indexOf","decodeURIComponent","token","set","console","log","postButton","$","connectButton","removeClass","hide","accessToken","confirmPostToFoursquare","Event","venue","swal","title","text","name","type","showCancelButton","closeOnConfirm","html","inputValue","toText","postToFoursquare","message","post","checkinUrl","id","placesList","buildPlaceLi","location","formattedAddress","join","on","bind","showInputError","listFoursquarePlaces","searchUrl","lis","venues","map","show","find","append","callbackUrl","clientId","baseUrl","apiBaseUrl","near","encodeURIComponent","msg","outerWidth","outerHeight"],"mappings":"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","file":"scripts/foursquare-script.js","sourcesContent":["'use strict';\n\n(function () {\n  var listenerForConnectFoursquare = addListenerFor('connectFoursquare', connectFoursquare);\n  var listenerForConnectCallback = void 0;\n  var accessToken = void 0;\n\n  function checkFoursquareLoginState() {\n    chrome.storage.sync.get('foursquareToken', function (result) {\n      if (result.foursquareToken) handleButtons(result.foursquareToken);\n    });\n  }\n\n  function addListenerFor(fnFor, callback) {\n    var listener = listenerFor(fnFor, callback);\n    addEventListener('message', listener, false);\n\n    return listener;\n  }\n  function listenerFor(fnFor, callback) {\n    return function (event) {\n      if (!event || !event.data || !event.data.to || event.data.to !== 'socialcalendarextension') return;\n      if (event.data.for !== fnFor) return;\n\n      callback(event.data);\n    };\n  }\n\n  var callbackUrl = 'https://foodtruckincubator.github.io/WeRat_Chrome/foursquare-callback.html';\n  var clientId = 'NCHNPGBJPIRJ44SFBIZYH2CP4G2JYF4OOBMDTYFZQ1L1ZLKD';\n  var baseUrl = 'https://foursquare.com/';\n  var apiBaseUrl = 'https://api.foursquare.com/v2';\n  var placesList = function placesList() {\n    return $('.socialcalendarextension-foursquare-places');\n  };\n\n  var authUrl = baseUrl + '/oauth2/authenticate?client_id=' + clientId + '&response_type=token&redirect_uri=' + callbackUrl;\n  var searchUrl = function searchUrl(token, near) {\n    return apiBaseUrl + '/venues/search?v=20160913&intent=browse&oauth_token=' + token + '&near=' + encodeURIComponent(near);\n  };\n  var checkinUrl = function checkinUrl(token, id, msg) {\n    return apiBaseUrl + '/checkins/add?v=20160913&oauth_token=' + token + '&venueId=' + id + '&shout=' + msg;\n  };\n\n  var windowOptions = 'width=500, height=500,left=' + (window.outerWidth - 500) / 2 + ', top=' + (window.outerHeight - 500) / 2.5;\n\n  function connectFoursquare() {\n    listenerForConnectCallback = addListenerFor('connectFoursquareCallback', connectCallback);\n    window.open(authUrl, '', windowOptions);\n  }\n\n  function connectCallback(data) {\n    removeEventListener('message', listenerForConnectCallback, false);\n\n    var search = data.response + '&'; // ensure parse\n\n    search = search.substr(search.indexOf('access_token=') + 13); // front access_token= to front\n    search = search.substr(0, search.indexOf('&')); // from 0 until first &\n    search = decodeURIComponent(search);\n\n    var token = search;\n\n    chrome.storage.sync.set({ foursquareToken: token }, function () {\n      console.log('Token ' + token + ' saved');\n\n      handleButtons(token);\n    });\n  }\n\n  function handleButtons(token) {\n    var postButton = $('#socialcalendarextension-share-modal-foursquare');\n    var connectButton = $('#socialcalendarextension-connect-foursquare');\n\n    postButton.removeClass('sce-disabled');\n    connectButton.hide();\n\n    accessToken = token;\n  }\n\n  function confirmPostToFoursquare(Event, event, venue, callback) {\n    swal({\n      title: 'Post in Foursquare',\n      text: 'Write what you want to share <small>(in ' + venue.name + ')</small>:',\n      type: 'input',\n      showCancelButton: true,\n      closeOnConfirm: false,\n      html: true,\n      inputValue: Event.toText(event)\n    }, callback);\n  }\n  function postToFoursquare(venue, message) {\n    $.post(checkinUrl(accessToken, venue.id, message), function (response) {\n      swal({\n        title: 'Nice!',\n        text: 'You checked in <strong>' + message + '</strong> at <strong>' + venue.name + '</strong> ',\n        type: 'success',\n        html: true\n      });\n\n      placesList().hide();\n    });\n  }\n\n  function buildPlaceLi(Event, event) {\n    return function (venue) {\n      return $('<li class=\"socialcalendarextension-foursquare-li\">').html('\\n        <span class=\"sce-f-li-name\">' + venue.name + '</span>\\n        <span class=\"sce-f-li-location\">' + venue.location.formattedAddress.join(' - ') + '</span>\\n      ').on('click', confirmPostToFoursquare.bind(null, Event, event, venue, function (inputValue) {\n        if (inputValue === false) return false;\n\n        if (inputValue === '') {\n          swal.showInputError('You need to write something!');\n          return false;\n        }\n        postToFoursquare(venue, inputValue);\n      }));\n    };\n  }\n  function listFoursquarePlaces(Event, event) {\n    $.get(searchUrl(accessToken, event.location), function (response) {\n      var lis = response.response.venues.map(buildPlaceLi(Event, event));\n\n      placesList().show().find('> ul').html('').append(lis);\n    });\n  }\n\n  window.checkFoursquareLoginState = checkFoursquareLoginState;\n  window.listFoursquarePlaces = listFoursquarePlaces;\n})();"],"sourceRoot":"/source/"}