{"version":3,"sources":["scripts/foursquare-script.js"],"names":["addListenerFor","fnFor","callback","listener","listenerFor","addEventListener","event","data","to","connectFoursquare","listenerForConnectCallback","connectCallback","window","open","authUrl","windowOptions","removeEventListener","search","response","substr","indexOf","decodeURIComponent","token","chrome","storage","sync","set","foursquareToken","console","log","accessToken","confirmPostToFoursquare","Event","venue","swal","title","text","name","type","showCancelButton","html","inputValue","toText","postToFoursquare","message","loading","fadeIn","placesList","hide","$","post","checkinUrl","id","fadeOut","buildPlaceLi","location","formattedAddress","join","on","bind","showInputError","listFoursquarePlaces","get","searchUrl","lis","venues","map","show","find","append","tryPostAtFoursquare","result","callbackUrl","clientId","baseUrl","apiBaseUrl","near","encodeURIComponent","msg","outerWidth","outerHeight"],"mappings":"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","file":"scripts/foursquare-script.js","sourcesContent":["'use strict';\n\n(function () {\n  var listenerForConnectCallback = void 0;\n  var accessToken = void 0;\n\n  function addListenerFor(fnFor, callback) {\n    var listener = listenerFor(fnFor, callback);\n    addEventListener('message', listener, false);\n\n    return listener;\n  }\n  function listenerFor(fnFor, callback) {\n    return function (event) {\n      if (!event || !event.data || !event.data.to || event.data.to !== 'socialcalendarextension') return;\n      if (event.data.for !== fnFor) return;\n\n      callback(event.data);\n    };\n  }\n\n  var callbackUrl = 'https://foodtruckincubator.github.io/WeRat_Chrome/foursquare-callback.html';\n  var clientId = 'NCHNPGBJPIRJ44SFBIZYH2CP4G2JYF4OOBMDTYFZQ1L1ZLKD';\n  var baseUrl = 'https://foursquare.com/';\n  var apiBaseUrl = 'https://api.foursquare.com/v2';\n  var placesList = function placesList() {\n    return $('.socialcalendarextension-foursquare-places');\n  };\n  var loading = function loading() {\n    return $('.socialcalendarextension-loading');\n  };\n\n  var authUrl = baseUrl + '/oauth2/authenticate?client_id=' + clientId + '&response_type=token&redirect_uri=' + callbackUrl;\n  var searchUrl = function searchUrl(token, near) {\n    return apiBaseUrl + '/venues/search?v=20160913&intent=browse&oauth_token=' + token + '&near=' + encodeURIComponent(near);\n  };\n  var checkinUrl = function checkinUrl(token, id, msg) {\n    return apiBaseUrl + '/checkins/add?v=20160913&oauth_token=' + token + '&venueId=' + id + '&shout=' + msg;\n  };\n\n  var windowOptions = 'width=500, height=500,left=' + (window.outerWidth - 500) / 2 + ', top=' + (window.outerHeight - 500) / 2.5;\n\n  function connectFoursquare(callback) {\n    listenerForConnectCallback = addListenerFor('connectFoursquareCallback', connectCallback(callback));\n    window.open(authUrl, '', windowOptions);\n  }\n\n  function connectCallback(callback) {\n    return function (data) {\n      removeEventListener('message', listenerForConnectCallback, false);\n\n      var search = data.response + '&'; // ensure parse\n\n      search = search.substr(search.indexOf('access_token=') + 13); // front access_token= to front\n      search = search.substr(0, search.indexOf('&')); // from 0 until first &\n      search = decodeURIComponent(search);\n\n      var token = search;\n\n      chrome.storage.sync.set({ foursquareToken: token }, function () {\n        console.log('Token ' + token + ' saved');\n\n        accessToken = token;\n        callback();\n      });\n    };\n  }\n\n  function confirmPostToFoursquare(Event, event, venue, callback) {\n    swal({\n      title: 'Post in Foursquare',\n      text: 'Write what you want to share <small>(in ' + venue.name + ')</small>:',\n      type: 'input',\n      showCancelButton: true,\n      html: true,\n      inputValue: Event.toText(event)\n    }, callback);\n  }\n  function postToFoursquare(venue, message) {\n    loading().fadeIn();\n    placesList().hide();\n\n    $.post(checkinUrl(accessToken, venue.id, message), function (response) {\n      loading().fadeOut();\n\n      swal({\n        title: 'Nice!',\n        text: 'You checked in <strong>' + message + '</strong> at <strong>' + venue.name + '</strong> ',\n        type: 'success',\n        html: true\n      });\n    });\n  }\n\n  function buildPlaceLi(Event, event) {\n    return function (venue) {\n      return $('<li class=\"socialcalendarextension-foursquare-li\">').html('\\n        <span class=\"sce-f-li-name\">' + venue.name + '</span>\\n        <span class=\"sce-f-li-location\">' + venue.location.formattedAddress.join(' - ') + '</span>\\n      ').on('click', confirmPostToFoursquare.bind(null, Event, event, venue, function (inputValue) {\n        if (inputValue === false) return false;\n\n        if (inputValue === '') {\n          swal.showInputError('You need to write something!');\n          return false;\n        }\n        postToFoursquare(venue, inputValue);\n      }));\n    };\n  }\n  function listFoursquarePlaces(Event, event) {\n    loading().fadeIn();\n    $.get(searchUrl(accessToken, event.location), function (response) {\n      loading().fadeOut();\n      var lis = response.response.venues.map(buildPlaceLi(Event, event));\n\n      placesList().show().find('> ul').html('').append(lis);\n    });\n  }\n\n  function tryPostAtFoursquare(Event, event) {\n    chrome.storage.sync.get('foursquareToken', function (result) {\n      if (result.foursquareToken) {\n        accessToken = result.foursquareToken;\n        return listFoursquarePlaces(Event, event);\n      }\n\n      swal({\n        title: 'Connect at Foursquare',\n        text: 'Click in <strong>Ok</strong> to connect with Foursquare first',\n        type: 'info',\n        showCancelButton: true,\n        html: true,\n        inputValue: Event.toText(event)\n      }, connectFoursquare.bind(null, listFoursquarePlaces.bind(null, Event, event)));\n    });\n  }\n\n  window.tryPostAtFoursquare = tryPostAtFoursquare;\n})();"],"sourceRoot":"/source/"}